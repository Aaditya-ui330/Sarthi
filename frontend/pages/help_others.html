<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Help Others! — Submit Audit — Sarthi</title>

  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/pages.css">

  <!-- Leaflet CSS (CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>

  <style>
    /* Page-specific */
    .page-grid { max-width:1100px; margin:28px auto; padding:0 18px; display:grid; grid-template-columns: 1fr 420px; gap:20px; }
    .card { background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); padding:18px; border-radius:12px; }
    #auditMap { width:100%; height:560px; border-radius:10px; overflow:hidden; }
    .field { margin-bottom:12px; display:flex; gap:12px; align-items:center; }
    .field label { min-width:140px; color:var(--muted); font-weight:600; }
    .field input[type="text"], .field select, .field textarea { flex:1; padding:10px 12px; border-radius:10px; border:none;background:rgba(255,255,255,0.03); color:var(--text); }
    .controls { display:flex; gap:8px; margin-top:14px; }
    .hint { color:var(--muted); font-size:0.95rem; margin-top:8px; }
    @media (max-width:900px) {
      .page-grid { grid-template-columns: 1fr; }
      #auditMap { height:320px; }
    }

    /* Suggestions dropdown (autocomplete) */
    #addressSuggestions { display:none; position:absolute; left:0; right:0; z-index:1200; max-height:260px; overflow:auto;
                         background: linear-gradient(180deg, rgba(20,24,28,0.96), rgba(16,18,22,0.96));
                         border:1px solid rgba(255,255,255,0.04); border-radius:8px; padding:6px; box-shadow:0 8px 24px rgba(0,0,0,0.7); }
    .suggestion-row { padding:10px; cursor:pointer; border-radius:6px; font-size:0.95rem; color:var(--text); }
    .suggestion-row:hover { background: rgba(255,255,255,0.02); }
    /* Small responsive tweak for address + coords layout */
    .coords-row { display:flex; gap:8px; align-items:center; }
    .coords-row input[type="text"] { width:120px; flex:initial; }
    #btnUseCurrentLocation { padding:8px 10px; border-radius:8px; border:none; background:linear-gradient(90deg,#5b4bff,#7a5bff); color:white; cursor:pointer; }
  </style>
</head>
<body>

  <!-- header/footer injected by app.js -->
  <div id="header"></div>

  <main>
    <div class="page-grid" role="main">
      <section class="card" aria-labelledby="helpTitle">
        <h1 id="helpTitle">Help Others! — Submit an Audit</h1>
        <p class="hint">Contribute a short audit about a location. You can link the submission to your account (recommended) or submit anonymously.</p>

        <div id="auditMap">Loading map…</div>
        <div class="hint" style="margin-top:10px">Click on the map to set the location. Drag the marker to adjust.</div>
        <div class="hint" style="margin-top:6px">Current: <span id="posText">not set</span></div>
      </section>

      <aside class="card" aria-labelledby="formTitle">
        <h2 id="formTitle">Audit details</h2>

        <form id="auditForm" novalidate>
          <!-- Address input with autocomplete -->
          <div class="field" style="align-items:flex-start">
            <label for="address">Address</label>
            <div style="position:relative; flex:1;">
              <input id="address" name="address" type="text" placeholder="Type an address or paste 'lat, lng'">
              <!-- #addressSuggestions is auto-created/used by help_others.js; fallback placed here for progressive enhancement -->
              <div id="addressSuggestions" aria-hidden="true"></div>
            </div>
          </div>

          <!-- Coordinates (readonly; filled from map or address selection) -->
          <div class="field">
            <label>Location</label>
            <div class="coords-row" style="flex:1;">
              <input id="lat" name="lat" type="text" placeholder="Latitude" readonly>
              <input id="lng" name="lng" type="text" placeholder="Longitude" readonly>
              <button id="btnUseCurrentLocation" type="button">Use current location</button>
            </div>
          </div>

          <div class="field">
            <label for="lighting">Lighting</label>
            <select id="lighting" name="lighting">
              <option value="0">Very poor</option>
              <option value="1">Poor</option>
              <option value="2" selected>OK</option>
              <option value="3">Good</option>
              <option value="4">Very good</option>
            </select>
          </div>

          <div class="field">
            <label for="visibility">Visibility</label>
            <select id="visibility" name="visibility">
              <option value="0">Very poor</option>
              <option value="1">Poor</option>
              <option value="2" selected>Okay</option>
              <option value="3">Good</option>
              <option value="4">Excellent</option>
            </select>
          </div>

          <div class="field">
            <label for="cctv">CCTV present</label>
            <select id="cctv" name="cctv">
              <option value="false" selected>No</option>
              <option value="true">Yes</option>
            </select>
          </div>

          <div class="field">
            <label for="crowd">Crowd density</label>
            <select id="crowd" name="crowd">
              <option value="low" selected>Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
          </div>

          <div class="field">
            <label for="crime">Observed crime</label>
            <select id="crime" name="crime">
              <option value="none" selected>None</option>
              <option value="low">Low</option>
              <option value="moderate">Moderate</option>
              <option value="high">High</option>
            </select>
          </div>

          <div class="field">
            <label for="security">Security presence</label>
            <select id="security" name="security">
              <option value="false" selected>No</option>
              <option value="true">Yes</option>
            </select>
          </div>

          <div class="field" style="align-items:flex-start">
            <label for="notes">Notes</label>
            <textarea id="notes" name="notes" rows="4" placeholder="Optional: short note about this place"></textarea>
          </div>

          <div class="field">
            <label for="anonymous">Submit as</label>
            <select id="anonymous" name="anonymous">
              <option value="false" selected>Link to my account</option>
              <option value="true">Submit anonymously</option>
            </select>
          </div>

          <div id="formFeedback" class="hint" role="status" aria-live="polite"></div>

          <div class="controls">
            <button id="btnSubmit" class="btn-primary" type="button">Submit Audit</button>
            <button id="btnClear" class="btn-outline" type="button">Clear</button>
          </div>
        </form>
      </aside>
    </div>
  </main>

  <div id="footer"></div>

  <!-- Leaflet JS (CDN) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- Firebase SDKs (needed because help_others.js imports auth.js) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <!-- Page scripts -->
  <!-- help_others.js expects these IDs and map.js to provide initSubmitMap / setMarker functions -->
  <script type="module" src="/js/help_others.js"></script>
  <script type="module" src="/js/map.js"></script>
  <script type="module" src="/js/app.js"></script>
  <script type="module" src="/js/ui_helpers.js"></script>
</body>
</html>
